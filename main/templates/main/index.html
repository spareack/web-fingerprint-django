<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>???</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body style=" font-size: 15px; line-height: 18px;">

    <div class="container" style="margin-top: 50px">

        <div>
            <b>Device Info:&nbsp;</b> <span style="margin-right: 200px;"> {{ user_agent_info }} </span>
        </div>

        <div class="separate-line"></div>

        <div>
            <b>Canvas test Hash:&nbsp;</b> <span id='canvas-hash-test' style="margin-right: 200px;"></span>
            <canvas id='myCanvas' width='200' height='40' style='border:1px solid #000000;'></canvas><br>
            <b>Canvas Fingerprint:&nbsp;</b> <span id='canvas-hash' style="margin-right: 100px;"></span>
        </div>

        <div class="separate-line"></div>

        <div>
            <b>Server Timezone:&nbsp;</b> <span style="margin-right: 100px;"> {{ location_data.utc_offset }} </span>
            <b>System Timezone:&nbsp;</b> <span id='system-time' style="margin-right: 100px;"></span>
            <b>Value:&nbsp;</b> <span id='timezone-value'></span>

        </div>

        <div class="separate-line"></div>

        <div> <!-- Screen Size -->
            <div><b>screenWidth:&nbsp;</b> <span id='screenWidth' style="margin-right: 100px;"></span></div>
            <div><b>screenHeight:&nbsp;</b> <span id='screenHeight'></span></div>
            <div><b>availableScreenWidth:&nbsp;</b> <span id='availableScreenWidth' style="margin-right: 100px;"></span> </div>
            <div><b>availableScreenHeight:&nbsp;</b> <span id='availableScreenHeight'></span></div>
            <div><b>windowOuterWidth:&nbsp;</b> <span id='windowOuterWidth' style="margin-right: 100px;"></span></div>
            <div><b>windowOuterHeight:&nbsp;</b> <span id='windowOuterHeight'></span></div>
            <div><b>windowInnerWidthWithScroll:&nbsp;</b> <span id='windowInnerWidthWithScroll' style="margin-right: 100px;"></span></div>
            <div><b>windowInnerHeightWithScroll:&nbsp;</b> <span id='windowInnerHeightWithScroll'></span></div>
            <div><b>windowInnerWidth:&nbsp;</b> <span id='windowInnerWidth' style="margin-right: 100px;"></span></div>
            <div><b>windowInnerHeight:&nbsp;</b> <span id='windowInnerHeight'></span></div>
            <div><b>pageWidth:&nbsp;</b> <span id='pageWidth' style="margin-right: 100px;"></span></div>
            <div><b>pageHeight:&nbsp;</b> <span id='pageHeight'></span></div>

            <div><b>TOR:&nbsp;</b> <span id='tor'>NO</span></div>
            <div><b>Proxy:&nbsp;</b> <span id='proxy'>NO</span></div>
            <div id="completeDevice"></div>
        </div>

        <div class="separate-line"></div>

        <div>
            {% for key, value in location_data.items %}
                <p><strong>{{ key }}:</strong> &nbsp; {{ value }}</p>
            {% endfor %}
        </div>

        <div class="separate-line"></div>

        <div>
            {% for key, value in params.items %}
                <p><strong>{{ key }}:</strong> &nbsp; {{ value }}</p>
            {% endfor %}
        </div>

        <div class="separate-line"></div>
    </div>

    <!-- canvas test-->
    <script>
      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");

      ctx.fillStyle = "rgb(255,0,255)";
      ctx.beginPath();
      ctx.rect(20, 20, 150, 100);
      ctx.fill();
      ctx.stroke();
      ctx.closePath();
      ctx.beginPath();
      ctx.fillStyle = "rgb(0,255,255)";
      ctx.arc(50, 50, 50, 0, Math.PI * 2, true);
      ctx.fill();
      ctx.stroke();
      ctx.closePath();

      txt = 'abz190#$%^@£éú';
      ctx.textBaseline = "top";
      ctx.font = '17px "Arial 17"';
      ctx.textBaseline = "alphabetic";
      ctx.fillStyle = "rgb(255,5,5)";
      ctx.rotate(.03);
      ctx.fillText(txt, 4, 17);
      ctx.fillStyle = "rgb(155,255,5)";
      ctx.shadowBlur=8;
      ctx.shadowColor="red";
      ctx.fillRect(20,12,100,5);

      src = canvas.toDataURL();
      hash = 0;

      for (i = 0; i < src.length; i++) {
          char = src.charCodeAt(i);
          hash = ((hash<<5)-hash)+char;
          hash = hash & hash;
      }

      document.getElementById('canvas-hash-test').textContent = hash;
    </script>

    <!-- canvas fingerprint-->
    <script>
      let height = window.screen.height;
      let width = window.screen.width;

      const fpPromise = import('https://openfpcdn.io/fingerprintjs/v3').then(FingerprintJS => FingerprintJS.load())

      fpPromise
        .then(fp => fp.get()).then(result => { const visitorId = result.visitorId
          document.getElementById('canvas-hash').textContent = visitorId;
        })
    </script>

    <!--  wurfl  -->
    <script src="//wurfl.io/wurfl.js" crossorigin></script>
    <!-- system time -->
    <script>
      var d = new Date();
      var tz = d.toString().split("GMT")[1].split(" (")[0];
      document.getElementById('system-time').textContent = tz;
      if (tz == {{ location_data.utc_offset }}) document.getElementById('timezone-value').textContent = 'Timezone check correct';
      else document.getElementById('timezone-value').textContent = 'Timezone check failed!';
    </script>


    <!-- Screen Size -->
    <script>
      const screenWidth = window.screen.width
      const screenHeight = window.screen.height;
      const availableScreenWidth = window.screen.availWidth;
      const availableScreenHeight = window.screen.availHeight;
      const windowOuterWidth = window.outerWidth;
      const windowOuterHeight = window.outerHeight;
      const windowInnerWidthWithScroll = window.innerWidth;
      const windowInnerHeightWithScroll = window.innerHeight;
      const windowInnerWidth = document.documentElement.clientWidth;
      const windowInnerHeight = document.documentElement.clientHeight;
      const pageWidth = document.documentElement.scrollWidth;
      const pageHeight = document.documentElement.scrollHeight;

      document.getElementById('screenWidth').textContent = screenWidth;
      document.getElementById('screenHeight').textContent = screenHeight;
      document.getElementById('availableScreenWidth').textContent = availableScreenWidth;
      document.getElementById('availableScreenHeight').textContent = availableScreenHeight;
      document.getElementById('windowOuterWidth').textContent = windowOuterWidth;
      document.getElementById('windowOuterHeight').textContent = windowOuterHeight;
      document.getElementById('windowInnerWidthWithScroll').textContent = windowInnerWidthWithScroll;
      document.getElementById('windowInnerHeightWithScroll').textContent = windowInnerHeightWithScroll;
      document.getElementById('windowInnerWidth').textContent = windowInnerWidth;
      document.getElementById('windowInnerHeight').textContent = windowInnerHeight;
      document.getElementById('pageWidth').textContent = pageWidth;
      document.getElementById('pageHeight').textContent = pageHeight;
      document.getElementById('completeDevice').textContent = WURFL.complete_device_name;

      if (screenWidth == availableScreenWidth && screenHeight == availableScreenHeight) document.getElementById('tor').textContent = "YES";
      if ( {{ proxy_value }} ) document.getElementById('proxy').textContent = "YES";

    </script>

    <script>
    let csrftoken = getCookie('csrftoken');

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function get_special_values()
    {
        let used_keys = []
        const slovar = new Object();

        function get_iter_objects(old_key, obj)
        {
            if (typeof(obj) == "object")
            {
                for(var key in obj) {
                    if (used_keys.indexOf(key) == -1)
                    {
                        used_keys.push(key)
                        get_iter_objects(key, obj[key])
                    }
                }
            }
            else if (typeof(obj) != "function" && obj != "") slovar[old_key] = obj
        }

        get_iter_objects("-1", window)
        return slovar
    }

    let data = {
        screenWidth,
        screenHeight,
        availableScreenWidth,
        availableScreenHeight,
        windowOuterWidth,
        windowOuterHeight,
        windowInnerWidthWithScroll,
        windowInnerHeightWithScroll,
        windowInnerWidth,
        windowInnerHeight,
        pageWidth,
        pageHeight,
<!--        WURFL,-->
        special_values: get_special_values(),
        test_hash: hash,
    }
    let config = {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json;charset=utf-8',
            "X-CSRFToken": csrftoken,
        },
        body: JSON.stringify(data),
    }
    console.log(get_special_values())
    fetch('/set_secret_data', config).then(res => console.log(res)).catch(error => console.log(error))

    </script>


    <style>
      .separate-line {
        margin: 20px 0;
        border-bottom: 2px solid red;
      }
    </style>
</body>
</html>